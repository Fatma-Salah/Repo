<div class="form-grid">
  <!-- @for (field of fields; track field.controlName) { -->
  @for (field of getVisibleFields(); track field.controlName) {

  <div
    class="form-field"
    [ngClass]="{
      'full-width': [
        'table',
        'map',
        'media',
        'accordion',
        'card',
        'accordionWithAdd'
      ].includes(field.type)
    }"
  >
    @if (field.type !== 'hidden') { @switch (field.type) { @case ('input') {
    <app-input
      [disabled]="
        (readOnly || field.readOnly || (field.preventUpdate! && Put)) &&
        !field.skipReadOnlyMood
      "
      [isOptional]="field.optional!"
      [label]="field.title ? translationPrefix + '.' + field.title : undefined"
      [value]="field.value"
      [appearLabel]="!field.disappearFieldTitle"
      [placeholder]="
        field.placeholder ? translationPrefix + '.' + field.placeholder : null
      "
      [type]="getInputType(field)"
      [control]="getFormControlFn(field)"
      [readonly]="readOnly && !field.skipReadOnlyMood"
    />
    } @case ('select') {
    <app-select
      [note]="field.note ? translationPrefix + '.' + field.note : undefined"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put) || field.readOnly!) &&
        !field.skipReadOnlyMood
      "
      [isOptional]="field.optional!"
      [manualTranslateOption]="field.manualTranslateOption || false"
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
      [appearLabel]="!field.disappearFieldTitle"
      [placeholder]="
        field.placeholder ? translationPrefix + '.' + field.placeholder : null
      "
      [options]="field.options"
      [control]="getFormControlFn(field)"
      (optionSelected)="getOptiaons($event)"
    />
    }
     <!-- @case ('radio') {
    <app-radio-button
      [isOptional]="field.optional!"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put)) && !field.skipReadOnlyMood
      "
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
      [options]="field.options"
      [control]="getFormControlFn(field)"
    />
    } @case ('textarea') {
    <app-textarea
      [isOptional]="field.optional!"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put) || field.readOnly!) &&
        !field.skipReadOnlyMood
      "

      [label]="field.title ? translationPrefix + '.' + field.title : undefined"
      [control]="getFormControlFn(field)"
    />
    } @case ('media') {
    <app-upload
      [isOptional]="field.optional!"
      [readOnly]="readOnly"
      [filesControl]="getFormControlFn(field)"
      [multiple]="getAcceptMultiple(field)"
      [acceptFileTypes]="getAcceptExtension(field)"
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
    />
    } -->
    @case ('multi-select') {
    <app-multi-select
      [appearLabel]="!field.disappearFieldTitle"
      [isOptional]="field.optional!"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put) || field.readOnly!) &&
        !field.skipReadOnlyMood
      "
      width="100%"
      height="50px"
      borderColor="transparent"
      bg="rgba(232, 232, 232, 0.7)"
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
      [placeholder]="
        field.placeholder ? translationPrefix + '.' + field.placeholder : null
      "
      [loading]="field.selectLoading || false"
      [options]="field.options"
      [control]="getFormControlFn(field)"
    >
    </app-multi-select>
    }
    <!-- @case ('quantity') {
    <app-quantity  [title]="translationPrefix + '.' + field.title" [control]="getFormControlFn(field)" />
    }  
    @case ('date') {
    <app-calender
      [placeholder]="
        field.placeholder
          ? 'date.' + field.placeholder
          : 'date.DATE_PLACEHOLDER'
      "
      [appearLabel]="!field.disappearFieldTitle"
      [isOptional]="field.optional!"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put) || field.readOnly!) &&
        !field.skipReadOnlyMood
      "
      width="100%"
      height="50px"
      borderColor="transparent"
      bg="rgba(232, 232, 232, 0.7)"
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
      [control]="getFormControlFn(field)"
      [minDateControlName]="field.minDateControl || null"
    >
    </app-calender>
    }
     @case ('toggle'){
    <app-toggle
      [control]="getFormControlFn(field)"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put) || field.readOnly!) &&
        !field.skipReadOnlyMood
      "
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
    ></app-toggle>
    } @case ('checkbox') {
    <app-check-box
      [isOptional]="field.optional!"
      [disabled]="
        (readOnly || (field.preventUpdate! && Put) || field.readOnly!) &&
        !field.skipReadOnlyMood
      "
      [options]="field.options || []"
      [title]="field.title ? translationPrefix + '.' + field.title : undefined"
      [control]="getFormControlFn(field)"
      width="100%"
      height="50px"
      borderColor="transparent"
      bg="rgba(232, 232, 232, 0.7)"
    >
    </app-check-box>
    } @case ('dynamic-checkbox-table') {
    <app-dynamic-checkbox-table
      [tableRowCheckBox]="field"
      [parentForm]="form"
      [translationPrefix]="translationPrefix"
    ></app-dynamic-checkbox-table>
    } -->
     @default {
    <p class="text-gray-500 italic">Unsupported field type: {{ field.type }}</p>
    } } }
    <ng-content></ng-content>
    <!-- Field validation errors -->
    @for (err of getErrorsForFieldFn(field); track $index) {
    <app-error-message [content]="err" />
    } @if (getMatchedServerErrorFn(field.controlName); as matchedErr) {
    <app-error-message [content]="matchedErr.message" />
    }
  </div>
  }

  <!-- Global server error -->
  @if (hasGlobalServerErrorFn() && serverMsgErr) {
  <div class="mt-3">
    <app-error-message [content]="serverMsgErr" />
  </div>
  }
</div>
